
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="Ajax in Magento can be pretty troublesome.Because you will need to take controllers and layout into account.And I almost used up a whole day trying &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://subeshpokhrel.github.io/blog/page/7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:subeshpokhrel.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/17/working-with-ajax-in-magento/">Working With AJAX in Magento</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-17T00:00:00+05:45" pubdate data-updated="true">Nov 17<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content">Ajax in Magento can be pretty troublesome.Because you will need to take controllers and layout into account.And I almost used up a whole day trying to make ajax work. Here are some of the steps I&#8217;d like to share so that you will not waste lots of your time, before making this work :D.

<strong>[UPDATE]</strong>
<h6>Get Ajaxify Extension from Magento Connect to work with AJAX on Magento</h6>
<a href="http://www.magentocommerce.com/magento-connect/ajaxify-8411.html" title="Ajaxify" target="_blank"><img src="http://www.magentocommerce.com/magento-connect/skin/frontend/enterprise/connect/images/logo-appstore.png"/></a>

Let&#8217;s first know in Magento terms what we need.

<strong>Controller:</strong> The url on which Ajax will work on, or the request URL. You will have to set up the controller with its frontend router set in config.xml and its corresponding controller class.
<strong>Layout:</strong> Layout to handle the requested URL and return HTML if required.
<strong>Block:</strong> The block to call through layout for the above controller.

Now lets be descriptive.

If you want to show a loader while request is being processed just add the following whereever you like in the phtml page.First fetch the Javascript.

[source language=&#8221;javascript&#8221;]
&lt;script src=&quot;&lt;?php echo $this-&gt;getJsUrl() ?&gt;mage/adminhtml/loader.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
[/source]

Then echo the loader which pops up. This loader will be similar to that of the admin.
[source language=&#8221;html&#8221;]
&lt;div id=&quot;loadingmask&quot; style=&quot;display: none;&quot;&gt;
&lt;div class=&quot;loader&quot; id=&quot;loading-mask-loader&quot;&gt;&lt;img src=&quot;&lt;?php echo str_replace(&quot;index.php/&quot;,&quot;&quot;,$this-&gt;getUrl()) ?&gt;skin/adminhtml/default/default/images/ajax-loader-tr.gif&quot; alt=&quot;&lt;?php echo $this-&gt;__(&#8216;Loading&#8230;&#8217;) ?&gt;&quot;/&gt;&lt;?php echo $this-&gt;__(&#8216;Loading&#8230;&#8217;) ?&gt;&lt;/div&gt;
&lt;div id=&quot;loading-mask&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
[/source]

Now to Call Ajax, use the following lines

[source language=&#8221;javascript&#8221;]

/*Please note that the URL is created in reloadurl. Also see that the response text will be echoed in div with id=output-div*/

var reloadurl = &#8216;&lt;?php echo $this-&gt;getUrl(&#8216;router/controller/action&#8217;) ?&gt;&#8217;;
Element.show(&#8216;loadingmask&#8217;);
new Ajax.Request(reloadurl, {
method: &#8216;post&#8217;,
parameters: &quot;Params_Here&quot;,
onComplete: function(transport) {
Element.hide(&#8216;loadingmask&#8217;);
$(&#8216;output-div&#8217;).innerHTML = &quot;&quot;;
$(&#8216;output-div&#8217;).innerHTML = transport.responseText;

}
});

[/source]

After the Ajax Request is made it goes to your controller&#8217;s action, which in turn sees to your layout as follows:

[source language=&#8221;php&#8221;]
class Namespace_module_frontendController extends Mage_Core_Controller_Front_Action
{
public function actionAction(){
$this-&gt;loadLayout()-&gt;renderLayout();
}
}
[/source]

And here is the main part in layout where I spent most of my time in. Since in layout we will have to define reference where the html will echo (Most of the times), i got stuck here, because i need to echo the output on the div with id output-div not in any reference.And the trick is to name the layout as root and output as html. Like the following:

[source language=&#8221;XML&#8221;]

&lt;module_controller_action&gt;
&lt;block type=&quot;module/block&quot;  name=&quot;root&quot; output=&quot;toHtml&quot;  template=&quot;module/template.phtml&quot;/&gt;
&lt;/module_controller_action&gt;
[/source]

You are done now! What ever you write or echo in phtml file you will see populated in the DIV. Now you can treat block as normally as you do before.

Happy Coding!!

<strong>[UPDATE]</strong>
<h6>Get Ajaxify Extension from Magento Connect to work with AJAX on Magento</h6>
<a href="http://www.magentocommerce.com/magento-connect/ajaxify-8411.html" title="Ajaxify" target="_blank"><img src="http://www.magentocommerce.com/magento-connect/skin/frontend/enterprise/connect/images/logo-appstore.png"/></a>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/16/how-to-get-query-as-a-string-in-magento/">How to Get Query as a String in Magento?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-16T00:00:00+05:45" pubdate data-updated="true">Nov 16<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content">Magento as you might know or not! has really a very PIA (Pain in the A**) type of methods to create SQL, execute and fetch! There are two ways of getting SQL from the collection of Magento. Here are the two ways.

<strong>1. Only Echoing Query String.</strong>
For just echoing the query string you must call printlogquery(), method the the collection. Like.
[source language=&#8221;php&#8221;]
/** If $collection is your collection**/
$collection->printlogquery(true);
/** Don&#8217;t forget to write true in param**/
[/source]

But by this method you cannot assign the query you get echoed to some variable. To get the query string here is what you do.

<strong>2. Getting the query String</strong>
[source language=&#8221;php&#8221;]
$query=$collection->getSelectSql(true);
echo $query;
[/source]

You can then use this $query to concat with more query, in some cases you desperately need this.

Stay Tuned!
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/15/wonder-if-this-is-the-reason-behind-the-name-gmail/">Wonder if This Is the Reason Behind the Name &#8220;Gmail&#8221;!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-15T00:00:00+05:45" pubdate data-updated="true">Nov 15<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content">I was working in Magento trying to print PDF of the shipping information, with out changing the locale of the site and it was set to &#8220;Dutch&#8221;. And I came up with this word &#8220;gemailed&#8221;, I pronounced it as &#8220;G-Mailed&#8221;. Then suddenly my mind clicked with a connection G-Mailed and Gmail. So i thought it would be a good (if not better) discovery and share on my blog. Here&#8217;s the screen shot of the translation.


<a href='http://subesh.com.np/wp-content/uploads/2009/11/gmail2.png'><img src="http://subesh.com.np/wp-content/uploads/2009/11/gmail2.png" alt="" title="gmail2" width="500" height="154" class="aligncenter size-full wp-image-80" /></a>

This is not any official thing or anything, just a mere coincidence, but really a thing to think about for once any may be crack a joke or say it to your friends.
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/07/23/get-latitude-and-longitude-of-user-from-simple-javascript/">Get Latitude and Longitude of User From Simple Javascript!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-07-23T00:00:00+05:45" pubdate data-updated="true">Jul 23<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content">I am a big fan of Latitude and Longitude, as you all might know, I have other post related to Latitude and Longitude and Google Maps.
I came across one of the greatest feature of Mozilla Firefox 3.5, and that was to get the latitude and Longitude of user using simple Javascript. No API to use, No query to Google or anything. Here&#8217;s the code.

[source language=&#8221;javascript&#8221;]
<script>
if (navigator.geolocation) {
 var watchID = navigator.geolocation.watchPosition(function(position) {
  do_something(position.coords.latitude, position.coords.longitude);
}
);
} else {
  alert("I'm sorry, but geolocation services are not supported by your browser.");
}

function do_something(lat,long){
alert(lat);
alert(long);
}
</script>
[/source]

Remember this only works on Mozilla Firefox 3.5. I&#8217;ll later come up with using this method to plot user on Google Maps, So follow on !
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/12/30/googling-google-on-google/">Googling &#8220;Google&#8221; on Google</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-12-30T00:00:00+05:45" pubdate data-updated="true">Dec 30<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content">Have you ever tried searching for &#8221;<strong>Google&#8221; on Google</strong>? You might have or not, I don&#8217;t know, but when I asked to one of my friend he gave me a very humorous answer. He said it would go into a &#8221;<strong>infinite loop</strong>&#8221;.
Mathematically speaking <strong>R=G(G)</strong>, here R is Result and G stands for searching in Google, where the searching parameter is itself Google (G). So, when you break it up or simplify this we can see as follows:

R=G(G)
R=G(G(G))
R=G(G(G(G)))&#8230;

So there is a never ending loop.
I don&#8217;t know if this is the &#8220;most absurd&#8221; deduction, but still you can think about it and just laugh :D

Those were all the fancy part of the post. I mean just to make the post seem humorous. Now I actually Googled for Google on Google. Google showed up with some of these &#8220;interesting&#8221; results.

<strong>Result Analysis I:</strong>

<a href='http://subesh.com.np/wp-content/uploads/2008/12/google1.jpg'><img src="http://subesh.com.np/wp-content/uploads/2008/12/google1.jpg" alt="" title="google1" width="500" height="174" class="aligncenter size-full wp-image-74" /></a>
This is the first result shown. As you can see it shows up with a www.google.com, with meta-description or title or the striped content
<code>Enables users to search the Web, Usenet, and images. Features include PageRank, caching and translation of results, and an option to find similar pages.</code>
And when you carefully observer the HTML codes of www.google.com, then you can see no such text (not even hidden) in the page, not in its meta content as well. So how is this possible, untill&#8230; someone injects that&#8230; someone who has the authority. You can think of anyone.. notes,books,page or heart,lungs,brain.. any one&#8230;
There were similar things happening with googlemaps,googlevideos,googlereader&#8230;&#8230;.

<strong>Result Analysis II:</strong>

<img src='http://www.thechurchofgoogle.org/Images/is_google_god.gif' alt='google2' class='alignleft' /> Another interesting site that comes up is <strong>http://www.thechurchofgoogle.org</strong>. This site claims Google to be the nearest to God where mankind have ever been to. It does not blindly worship Google as God but gives you 9 scientific/spiritual proof, for believing that. It says Google as<strong> Omniscient</strong> (all-knowing) and <strong>Omnibenevolent</strong> in a most logical fashion that no one can argue. The most interesting proof is proof#8

<img src='http://www.thechurchofgoogle.org/Images/google-trends-large.gif' alt='Google Trend' class='aligncenter' />

<code>According to Google trends, the term "Google" is searched for more than the terms "God", "Jesus", "Allah", "Buddha", "Christianity", "Islam", "Buddhism" and "Judaism"  combined. </code>

<strong>Result Analysis III:</strong>

<img src='http://justfuckinggoogleit.com/bart.gif' alt='google it' class='aligncenter' />

You can find this on <strong>http://justfuckinggoogleit.com</strong>. It is just a site.. reminding the power of Google or claims &#8220;All Smart people user Google&#8221;. Nice to own such a domain.

<strong>Result Analysis IV:</strong>

<a href='http://subesh.com.np/wp-content/uploads/2008/12/google4.jpg'><img src="http://subesh.com.np/wp-content/uploads/2008/12/google4.jpg" alt="" title="google4" width="293" height="307" class="alignleft size-full wp-image-75" /></a>

<strong>www.googlefight.com</strong>. This site makes a fight amongst the two keywords on the basis of total number of search results of the respective keywords returned from Google. It was fun.. at least to me while comparing with my name and friends name.

Guess this would be my last post for this year&#8230; and I would take a chance to wish you all a very <strong>HAPPY NEW YEAR.</strong>.. Keep Googling.. on Google.
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/10/26/newsletter-email-tracking-read-or-not/">Newsletter Email Tracking: Read or Not?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-10-26T00:00:00+05:45" pubdate data-updated="true">Oct 26<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content">I have completed first phase of a simple, yet useful Newsletter System. When I demonstrated to the clients, they came up with a question if the newsletter being send was opened or not by the newsletter subscribers ? I then thought.. let see how its done. Then I came with this simple tracking trick, most of the <strong>spammers </strong>used to verify if the email address was valid or not.
The first thing I did was adding 1px by 1px image on the footer of the newsletter, whose source was set something like this <em>http://subesh.com.np/newsletter/track.php?identitycode=CLIENTID_SENDEMAILID</em>. Here CLIENTID = Your Clients ID and SENDEMAILID = Id of the Newsletter sent. Now, when the image is loaded while viewing the newsletter on the mail or say when the client reads the newsletter email. The track.php page is requested with identitycode as the GET parameter. And when you get the request from the mail to your server&#8217;s page, you can do anything you want. What I did was setting the mail_read column of the database field as 1. And echoed the source of the image file on the last line.
The code below is for the track.php.

[source=&#8221;php&#8221;]
<?php
$get=explode("_",$_GET['identitycode']);
$sendid=$get['0'];
$recid=$get['1'];
$query="INSERT INTO tbl_track SET mail_read='1' WHERE send_id='$sendid' and user_id='$recid'";
mysql_query($query);
echo "http://subesh.com.np/newsletter/images/transparent_1px.gif";
?>
[/source]
Isn&#8217;t this the easiest idea anyone could ever come up with. Yeha! Thumbs up to me!!
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/09/23/facebook-chat-on-a-side-bar-of-mozilla/">Facebook Chat on a Side Bar of Mozilla</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-09-23T00:00:00+05:45" pubdate data-updated="true">Sep 23<span>rd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content">These days I am using Facebook a lot and no wonder everyone is using Facebook a lot. And the number of online users on Facebook are sometimes more then my MSN Messager online friends list. I get so much of words from my friends saying I did not reply to their message on Facebook Chat. In fact I open so much of mozilla window and tabs while working that, I come across the Facebook page once in a while. Then I came up with this idea of opening Facebook Chat on the side bar (i.e Bookmark Side Bar), and to my delight&#8230;.. IT WORKED!&#8230;.

Here&#8217;s is what I did on Mozilla. It&#8217;s a simple trick. I just added a new bookmark on mozilla.

Step 1: BOOKMARKS>>ORGANIZE BOOKMARK
Step 2: ORGANIZE>>ADD NEW BOOKMARK
STEP 3: Add Name: (Any Name)
STEP 4: Add Location: http://www.new.facebook.com/presence/popout.php
<strong>STEP 5: Don&#8217;t Forget To Check the Load this bookmark in sidebar</strong>

Now you are done. Go to Recently Bookmarked and Open this bookmark. The bookmark then open in the sidebar of you mozilla. No matter which page you are browsing you are chatting on Facebook.
My recommendation is to use wide screen display, so that you will have enough room to chat and browse page.
How did you like the idea? I am sure most of you all will give me a thumbs up!
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/07/22/ajaxified-file-uploader-using-iframe/">Ajaxified File Uploader Using IFrame</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-07-22T00:00:00+05:45" pubdate data-updated="true">Jul 22<span>nd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content">Today, while writing a code for AJAX file uploader, I was trying to do with [wiki]SALAJAX[/wiki]. But, with <strong>SALAJAX</strong> I could not manage to send the headers for <strong>$_FILES</strong>. So I thought of an alternative. And the alternative was to load the action page of the form on [wiki]IFrame[/wiki], whose display would be hidden and the work for uploading the file will be done on the background without refreshing the page. Yeha.. Its not [wiki]AJAX[/wiki], but it gives a user the feel of asynchronous working on the page. So, my code is <strong>Asynchronous Feel Without Javascript and XML (AFWJAX)</strong>. What do think about this?
So, Here&#8217;s the code.The code below is for the form.
[sourcecode=&#8221;html&#8221;]
<form action="iframeinc.php" method="post" enctype="multipart/form-data" id="uploadform" target="iframe" name="uploadform">
 File:
  <input name="pic" type="file" id="pic" style="margin-right:50px;" />
  <br />
<input type="submit" name="Submit" value="Upload" ><br />
<iframe name="iframe" src="iframeinc.php" width="200" height="500" style="display:none;"> </iframe>
</form>
[/sourcecode]

You can see on <strong>#1</strong> the action of the form is <strong>iframeinc.php</strong>. The code for this page is given below. There are some other things you should remember. Like the <strong>target</strong> for the form is set <strong>iframe</strong>, whose <strong>display</strong> is set <strong>none</strong> so that it is not seen.  And this iframe is the of the iframe created on <strong>#6</strong>, whose source is the <strong>iframeinc.php</strong>. Now here&#8217;s its code.
[sourcecode=&#8221;php&#8221;]
<?php
if($_POST){

	// $newname is the new path/name of the file on the server.
	$copied = copy($_FILES['pic']['tmp_name'], "$newname");

}
?>
[/sourcecode]

Remember to set <strong>$newname</strong> value before running this. At first run you may see this as a regular post script, but try to reload with f5 or reload button of your browser, you will not be asked to retry or resend the post header. So, there are own ways of catching your nose.
<a href="http://subeshexamples.googlecode.com/files/upload.rar"><strong>[Download Source]</strong></a>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/07/16/tabbed-infowindow-in-google-maps/">Tabbed Infowindow in Google Maps</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-07-16T00:00:00+05:45" pubdate data-updated="true">Jul 16<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content">I wanted to show different categories of information on one GMarker. That is I wanted to show different types of information on a Infowindow for a point on Google Maps. For that I used a tabbed info window, which helped me to show different data on each tabs. Here is the code of what I have done. I have shown the latitude and longitude of a placed clicked on the map on the tabbed info window. This is just the script part. The demo and download links are given below.

[sourcecode=&#8221;javascript&#8221;]
 <script type="text/javascript">
     var iconBlue = new GIcon();
    iconBlue.image = 'http://labs.google.com/ridefinder/images/mm_20_blue.png';
    iconBlue.shadow = 'http://labs.google.com/ridefinder/images/mm_20_shadow.png';
    iconBlue.iconSize = new GSize(12, 20);
    iconBlue.shadowSize = new GSize(22, 20);
    iconBlue.iconAnchor = new GPoint(6, 20);
    iconBlue.infoWindowAnchor = new GPoint(5, 1);
    var point = new GLatLng(26.88157422515243, 86.30859375);
    function load() {
		  if (GBrowserIsCompatible()) {
			var map = new GMap2(document.getElementById("map"));
			map.setCenter(point,3);
			GEvent.addListener(map, 'click', function(overlay, point) {
			  var lati=point.lat();
			  var long=point.lng();
			  var marker= new GMarker(new GLatLng(lati, long),{draggable: false});
			  map.addOverlay(marker);
				  var infoTabs = [	new GInfoWindowTab("Lat-Tab", "<h1> Latitude:</h1><br />"+lati),	new GInfoWindowTab("Long-Tab", "<h1>Longitude</h1><br />"+long)];
			  marker.openInfoWindowTabsHtml(infoTabs);
			 });
		}
	}
  </script>
[/sourcecode]

Lets focus on the <strong>#17-#26</strong> Lines of codes. Other Lines are already described on other posts. Please see the related post link below the post.
<strong>#17:</strong> Creates a GMarker on the point where clicked on the Map.
<strong>#18:</strong> Addes the GMarker over the Map.
<strong>#19:</strong> Initiates an array of tabs<strong>infoTabs </strong> with <strong>GInfoWindowTab </strong> function with <strong>tabname</strong> and its <strong>innerHTML</strong> as parameters.
<strong>#20:</strong> Opens the infowindow calling <strong>openInfoWindowTabsHtml</strong> function and the array of tabs as parameters.

<a href="http://subeshexamples.googlecode.com/files/tabinfo.html"><strong>[Download]</strong></a> <a href="http://subesh.com.np/demo/tabinfo.html"><strong>[Demo]</strong></a>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2008/07/11/mapping-the-ip-address-to-latitude-and-longitude-in-google-maps/">Mapping the IP Address to Latitude and Longitude in Google Maps</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-07-11T00:00:00+05:45" pubdate data-updated="true">Jul 11<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content">At last I found <strong>hostip.info</strong> provides a service for getting the latitude and longitude of a place on the basis of the user&#8217;s ip address. Its light weight and free, rather than downloading bulky database and getting paid services, for getting <strong>latitude and longitude</strong> on the basis of IP.
Here is the simplest way to do it. Requested to<strong> http://api.hostip.info/?ip=$ip&position=true</strong> it responds XML formatted output. So we need to parse XML code using DOM class of PHP.<strong>(#19-#23)</strong>. Remember, the <strong>position=true</strong> should be set to get the latitude and longitude otherwise it will not show on default.
<!--readmore-->
Here is the code and I will soon upload the working demo.
[sourcecode=&#8221;php&#8221;]
<?php
/*
Subesh Pokhrel
subesh.com.np
Get the code for Real IP of the site from roshanbh.com.np
Mapping The IP Address to Latitude and Longitude.
*/
function IPtoLatLng($ip)
{
	$latlngValue=array();
	$dom = new DOMDocument();
	$ipcheck = ip2long($ip);

    if($ipcheck == -1 || $ipcheck === false){
		echo "ERROR: INVALID IP";
		exit;
	}
	else
		$uri = "http://api.hostip.info/?ip=$ip&position=true";
 	$dom->load($uri);
	$name=$dom->getElementsByTagNameNS(&#8216;http://www.opengis.net/gml&#8217;,&#8217;name&#8217;)->item(1)->nodeValue;
	$coordinates=$dom->getElementsByTagNameNS(&#8216;http://www.opengis.net/gml&#8217;,&#8217;coordinates&#8217;)->item(0)->nodeValue;
	$temp=explode(&#8220;,&#8221;,$coordinates);
	$latlngValue[&#8216;LNG&#8217;]=$temp[0];
	$latlngValue[&#8216;LAT&#8217;]=$temp[1];
	$latlngValue[&#8216;NAME&#8217;]=$name;
	return $latlngValue;

}
//calling the functions and setting on array $latlng
$IP=getRealIpAddr(); //from roshanbh.com.np
$latlng=IPtoLatLng($IP);
?>
[/sourcecode]
<strong>[UPDATE] <a href="http://subeshexamples.googlecode.com/files/ip.php">[DOWNLOAD]</a></strong>
Due to high request of the visitors I have posted the whole source code here.. just copy the PHP part above anywhere the script part and get the IP code from http://roshanbh.com.np/2007/12/getting-real-ip-address-in-php.html and run. Remember you need PHP5, because the DOM used is of PHP5.

[sourcecode=&#8221;html&#8221;]
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Google Maps Plotting  User By Refrence Of IP Address | Subesh.com.np</title>

 <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAPHLcOOGHX2-uLk3K8q1nMRSFS3Iba-Yq79Uuy07kI14Q-o9MOhQTADZYj-oIAYvmRBVx8i9NqeBSjg"
      type="text/javascript"></script>
    <script type="text/javascript">
    //<![CDATA[

    var iconBlue = new GIcon();
    iconBlue.image = 'http://labs.google.com/ridefinder/images/mm_20_blue.png';
    iconBlue.shadow = 'http://labs.google.com/ridefinder/images/mm_20_shadow.png';
    iconBlue.iconSize = new GSize(12, 20);
    iconBlue.shadowSize = new GSize(22, 20);
    iconBlue.iconAnchor = new GPoint(6, 20);
    iconBlue.infoWindowAnchor = new GPoint(5, 1);

	var point = new GLatLng(parseFloat('<?=$latlng['LAT']?>'),parseFloat('<?=$latlng['LNG']?>'));

		function load() {
		  if (GBrowserIsCompatible()) {
			var map = new GMap2(document.getElementById("map"));
			map.setCenter(new GLatLng(parseFloat('<?=$latlng['LAT']?>'),parseFloat('<?=$latlng['LNG']?>')),3);
			var marker = createMarker(point);
            map.addOverlay(marker);
		}
	}

	 function createMarker(point) {
      var marker = new GMarker(point, iconBlue);
      var html = "<h1>Gothcha! HA HA </h1> <br />You Are Here !<br /><b><?=$latlng['NAME']?></b> ";
      GEvent.addListener(marker, 'mouseover', function() {
        marker.openInfoWindowHtml(html);
      });
      return marker;
    }
 //

  
 
  
  Subesh.com.np: Maps Example
   


[/sourcecode] ]]>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/8/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/6/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/09/16/some-of-the-funniest-comments-on-code-quora-discovery/">Some of the Funniest Comments on Code - Quora Discovery</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/12/magenote-select-first-options-of-the-configurable-product-options-on-load/">MageNote - Select First Options of the Configurable Product Options on Load</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/07/the-most-popular-programming-jokes-quora/">The Most Popular Programming Jokes - Quora</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/06/is-consciousness-a-form-of-energy/">Is Consciousness a Form of Energy?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/06/ajaxify-now-available-on-github/">Ajaxify - Now Available on Github</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
